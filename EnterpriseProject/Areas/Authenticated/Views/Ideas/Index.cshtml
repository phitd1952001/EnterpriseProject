@using EnterpriseProject.Utility
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model EnterpriseProject.ViewModels.TopicsVM

@{
    Layout = "_Layout";
}


<div class="row">
    <div class="col-6">
        <h1>Idea Table</h1>
    </div>
    <div class="col-6">
        @if (Model.Topic.ClosureDate > DateTime.Now)
        {
            <a asp-controller="Ideas" asp-action="Upsert" asp-route-topicId="@Model.Topic.Id" class="btn btn-success"><i class="fas fa-plus"></i> &nbsp;Create New Idea</a>
        }
        <form class="form-inline my-2 my-lg-0 float-right">
            <input id="myInput" class="form-control mr-sm-2" type="text" placeholder="Search">
        </form>
    </div>
</div>
<div>
    <table class="table">
        <thead>
        <tr>
            <th scope="col">Name</th>
            <td scope="col">@Model.Topic.Name</td>
        </tr>
        <tr>
            <th scope="col">Deadline 1</th>
            <td scope="col">@Model.Topic.ClosureDate</td>
        </tr>
        <tr>
            <th scope="col">Deadline 2</th>
            <td scope="col">@Model.Topic.FinalClosureDate</td>
        </tr>
        </thead>
    </table>
</div>
<div>
    <a asp-controller="Topics" asp-action="Index" class="btn btn-success">
        Back List
    </a>
</div>
<table class="table">
    <thead>
    <tr>
        <th scope="col">#</th>
        <th scope="col">Text</th>
        <th scope="col">File Path</th>
        <th scope="col">Datetime</th>
        <th scope="col">Category</th>
        <th scope="col">Topic</th>
        <th scope="col">User</th>
        <th scope="col">View</th>
        <th scope="col">Like</th>
        <th scope="col">Dislike</th>
        <th scope="col">Action</th>
    </tr>
    </thead>
    <tbody id="tblData">

    <form method="get" asp-action="Index" asp-controller="Ideas">
    </form>

    @foreach (var obj in @Model.ReactVms)
    {
        <tr>
            <th scope="row">@obj.Idea.Id</th>
            <td>@obj.Idea.Text</td>
            <td>@obj.Idea.FileId</td>
            <td>@obj.Idea.DateTime</td>
            <td>@obj.Idea.Category.Name</td>
            <td>@obj.Idea.Topic.Name</td>
            @if (User.IsInRole(SD.Role_Admin) || User.IsInRole(SD.Role_Manager))
            {
                <td>@obj.Idea.ApplicationUser.FullName</td>
            }
            else
            {
                <td>anynomous</td>
            }
            <td>@obj.View</td>
            <td>@obj.Like</td>
            <td>@obj.DisLike</td>
            <td>
                @if (User.IsInRole(SD.Role_Admin) || User.IsInRole(SD.Role_Manager))
                {
                    <a asp-controller="Ideas" asp-action="Upsert" asp-route-id="@obj.Idea.Id" asp-route-topicId="@Model.Topic.Id" style="color: #FFD700; font-size: 25px" class="btn-outline">
                        <i class="fa-solid fa-pen-to-square"></i>
                    </a>
                    <a asp-controller="Ideas" asp-action="Delete" asp-route-id="@obj.Idea.Id" style="color: #c82333; font-size: 25px" class="btn-outline">
                        <i class="fa-solid fa-trash-can"></i>
                    </a>
                }
                @if (User.IsInRole(SD.Role_Admin) || User.IsInRole(SD.Role_Manager) || User.IsInRole(SD.Role_Staff) || User.IsInRole(SD.Role_Coordinator))
                {
                    if (obj.Idea.Topic.ClosureDate > DateTime.Now && obj.Idea.Topic.FinalClosureDate > DateTime.Now)
                    {
                        <a asp-controller="React" asp-action="Like" asp-route-ideaId="@obj.Idea.Id" style="color: #1b6ec2; font-size: 25px" class="btn-outline">
                            <i class="fa-regular fa-thumbs-up"></i>
                        </a>
                        <a asp-controller="React" asp-action="DisLike" asp-route-ideaId="@obj.Idea.Id" style="color: #1b6ec2; font-size: 25px" class="btn-outline">
                            <i class="fa-sharp fa-regular fa-thumbs-down"></i>
                        </a>
                        <a asp-controller="Comments" asp-action="Index" asp-route-ideaId="@obj.Idea.Id" style="color: #95999c; font-size: 25px" class="btn-outline">
                            <i class="fa-regular fa-comments"></i>
                        </a>
                        <a asp-controller="Ideas" asp-action="Download" asp-route-id="@obj.Idea.FileId" style="color: #4e555b; font-size: 25px" class="btn-outline">
                            <i class="fa-solid fa-file-arrow-down"></i>
                        </a>
                    }
                }
            </td>
        </tr>
    }
    </tbody>
</table>

@section Scripts
{
    <script>
         $(document).ready(function (){
             $("#myInput").on("keyup", function(){
              var value = $(this).val().toLowerCase();
             $("#tblData tr").filter(function (){
                 $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
             });
         });
     });
    </script>
}